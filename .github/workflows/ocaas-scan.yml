name: OCaaS Scan

on:
  schedule:
    # At 22:35 from Monday through Friday.
    - cron: 35 22 * * 1-5
  workflow_dispatch:
    inputs:
      emails:
        description: Email addresses to send the report to (separated by semicolon)
        required: true
        default: Brg_XC-CT_RideCare_DevCloud@bosch.com

jobs:
  ocaas-scan-project:
    name: OCaaS scan on code
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Get branch name
        run: echo "branch=${GITHUB_REF#refs/heads/}" >> $GITHUB_ENV

      - name: OCaaS Scan on ${{ env.branch }}
        id: ocaas
        uses: docker://osmipublic.azurecr.io/ocaas-ci:latest
        with:
          args: auth generate-token run start
        env:
          OCAAS_USERNAME: ${{ secrets.OCAAS_USERNAME }}
          OCAAS_PASSWORD: ${{ secrets.OCAAS_PASSWORD }}
          PROJECT_NAME: "ridecare_devcloud_source_code"
          PIPELINE_ID: 407 # Your pipeline ID. Provided by the OSMI team.
          VCS_URL: ${{ github.server_url }}/${{ github.repository }}.git
          VCS_REVISION: ${{ env.branch }}
          APPLICATION_CATEGORY: "BT10"
          BLOCKING: false
          EMAIL_RECIPIENTS: ${{ inputs.emails }}
